!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("xterm"),require("@open-amt-cloud-toolkit/ui-toolkit/core"),require("@angular/cdk/keycodes"),require("@angular/router"),require("@angular/platform-browser"),require("@angular/platform-browser/animations"),require("@angular/flex-layout"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("sol",["exports","@angular/core","xterm","@open-amt-cloud-toolkit/ui-toolkit/core","@angular/cdk/keycodes","@angular/router","@angular/platform-browser","@angular/platform-browser/animations","@angular/flex-layout","@angular/common/http"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sol={},e.ng.core,e.xterm,e["@open-amt-cloud-toolkit"]["ui-toolkit"].core,e.ng.cdk.keycodes,e.ng.router,e.ng.platformBrowser,e.ng.platformBrowser.animations,e.ng.flexLayout,e.ng.common.http)}(this,(function(e,t,o,n,r,i,s,a,l,u){"use strict";var c=function(){};c.ɵfac=function(e){return new(e||c)},c.ɵprov=t.ɵɵdefineInjectable({token:c,factory:c.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(c,[{type:t.Injectable,args:[{providedIn:"root"}]}],(function(){return[]}),null);var d=function(){function e(e,o){this.params=e,this.activatedRoute=o,this.uuid="",this.server="",this.logger=new n.ConsoleLogger(n.LogLevel.ERROR),this.deviceStatus=new t.EventEmitter,this.deviceConnection=new t.EventEmitter,this.token=localStorage.getItem("loggedInUser"),this.server=this.urlConstructor()+"/relay",this.mpsServer=this.params.mpsServer.includes("/mps"),this.mpsServer&&(this.server=this.urlConstructor()+"/ws/relay")}return e.prototype.urlConstructor=function(){return this.params.mpsServer.replace("http","ws")},e.prototype.ngOnInit=function(){var e=this;this.activatedRoute.params.subscribe((function(t){e.uuid=t.id})),this.deviceConnection.subscribe((function(t){t?e.init():e.stopSol()}))},e.prototype.ngAfterViewInit=function(){this.init()},e.prototype.init=function(){var e=this;this.instantiate(),setTimeout((function(){e.startSol()}),4e3)},e.prototype.instantiate=function(){var e=this;this.terminal=new n.AmtTerminal,this.dataProcessor=new n.TerminalDataProcessor(this.terminal),this.redirector=new n.AMTRedirector(this.logger,n.Protocol.SOL,new FileReader,this.uuid,16994,"","",0,0,JSON.parse(this.token).token,this.server),this.terminal.onSend=this.redirector.send.bind(this.redirector),this.redirector.onNewState=this.terminal.StateChange.bind(this.terminal),this.redirector.onStateChanged=this.onTerminalStateChange.bind(this),this.redirector.onProcessData=this.dataProcessor.processData.bind(this),this.dataProcessor.processDataToXterm=this.handleWriteToXterm.bind(this),this.dataProcessor.clearTerminal=this.handleClearTerminal.bind(this),this.container=document.getElementById("terminal"),this.term=new o.Terminal({rows:30,cols:100,cursorStyle:"block",fontWeight:"bold"}),this.term.open(this.container),this.term.onData((function(t){e.handleKeyPress(t)})),this.term.attachCustomKeyEventHandler((function(t){return t.stopPropagation(),t.preventDefault(),!0===t.ctrlKey&&!0===t.shiftKey&&t.keyCode===r.C?navigator.clipboard.writeText(e.term.getSelection()):!0===t.ctrlKey&&!0===t.shiftKey&&t.keyCode===r.V?navigator.clipboard.readText().then((function(t){e.handleKeyPress(t)})):t.code===r.SPACE?e.handleKeyPress(t.key):void 0}))},e.prototype.handleKeyPress=function(e){this.terminal.TermSendKeys(e)},e.prototype.handleClearTerminal=function(){this.term.reset()},e.prototype.handleWriteToXterm=function(e){this.term.write(e)},e.prototype.onTerminalStateChange=function(e,t){this.deviceStatus.emit(t)},e.prototype.startSol=function(){null!==this.redirector&&this.redirector.start(WebSocket)},e.prototype.stopSol=function(){null!==this.redirector&&(this.redirector.stop(),this.handleClearTerminal(),this.term.dispose(),this.cleanup())},e.prototype.cleanup=function(){this.terminal=null,this.redirector=null,this.dataProcessor=null,this.term=null},e.prototype.ngOnDestroy=function(){this.stopSol()},e}();d.ɵfac=function(e){return new(e||d)(t.ɵɵdirectiveInject("userInput"),t.ɵɵdirectiveInject(i.ActivatedRoute))},d.ɵcmp=t.ɵɵdefineComponent({type:d,selectors:[["amt-sol"]],inputs:{deviceConnection:"deviceConnection"},outputs:{deviceStatus:"deviceStatus"},decls:2,vars:0,consts:[[1,"container"],["id","terminal",1,"xtermDisplay",2,"width","fit-content"]],template:function(e,o){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵelement(1,"div",1),t.ɵɵelementEnd())},styles:[".container{display:block;text-align:center}.xtermDisplay{display:inline-block}"],encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(d,[{type:t.Component,args:[{selector:"amt-sol",templateUrl:"./sol.component.html",styleUrls:["./sol.component.css"],encapsulation:t.ViewEncapsulation.None}]}],(function(){return[{type:void 0,decorators:[{type:t.Inject,args:["userInput"]}]},{type:i.ActivatedRoute}]}),{deviceStatus:[{type:t.Output}],deviceConnection:[{type:t.Input}]});var p=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:"userInput",useValue:t}]}},e}();p.ɵfac=function(e){return new(e||p)},p.ɵmod=t.ɵɵdefineNgModule({type:p}),p.ɵinj=t.ɵɵdefineInjector({imports:[[u.HttpClientModule,l.FlexLayoutModule,s.BrowserModule,a.BrowserAnimationsModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(p,{declarations:[d],imports:[u.HttpClientModule,l.FlexLayoutModule,s.BrowserModule,a.BrowserAnimationsModule],exports:[d]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(p,[{type:t.NgModule,args:[{declarations:[d],imports:[u.HttpClientModule,l.FlexLayoutModule,s.BrowserModule,a.BrowserAnimationsModule],exports:[d],schemas:[t.CUSTOM_ELEMENTS_SCHEMA]}]}],null,null),e.SolComponent=d,e.SolModule=p,e.SolService=c,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sol.umd.min.js.map