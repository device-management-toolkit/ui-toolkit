!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@open-amt-cloud-toolkit/ui-toolkit/core"),require("rxjs"),require("rxjs/operators"),require("@angular/router"),require("@angular/platform-browser"),require("@angular/platform-browser/animations"),require("@angular/flex-layout"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("kvm",["exports","@angular/core","@open-amt-cloud-toolkit/ui-toolkit/core","rxjs","rxjs/operators","@angular/router","@angular/platform-browser","@angular/platform-browser/animations","@angular/flex-layout","@angular/common/http"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).kvm={},e.ng.core,e["@open-amt-cloud-toolkit"]["ui-toolkit"].core,e.rxjs,e.rxjs.operators,e.ng.router,e.ng.platformBrowser,e.ng.platformBrowser.animations,e.ng.flexLayout,e.ng.common.http)}(this,(function(e,t,o,n,r,i,s,u,a,d){"use strict";var c=["canvas"],l=["device"],h=function(){function e(e,o){var n=this;this.params=e,this.activatedRoute=o,this.width=400,this.height=400,this.deviceStatus=new t.EventEmitter,this.deviceConnection=new t.EventEmitter,this.selectedEncoding=new t.EventEmitter,this.powerState=0,this.deviceId="",this.selected=1,this.server="",this.mouseMove=null,this.encodings=[{value:1,viewValue:"RLE 8"},{value:2,viewValue:"RLE 16"}],this.urlConstructor=function(){return n.params.mpsServer.replace("http","ws")},this.onConnectionStateChange=function(e,t){n.deviceStatus.emit(t)},this.reset=function(){n.redirector=null,n.module=null,n.dataProcessor=null,n.height=400,n.width=400,n.instantiate()},this.stopKvm=function(){n.redirector.stop(),n.keyboardHelper.UnGrabKeyInput(),n.reset()},this.token=localStorage.getItem("loggedInUser"),this.server=this.urlConstructor()+"/relay",this.mpsServer=this.params.mpsServer.includes("/mps"),this.mpsServer&&(this.server=this.urlConstructor()+"/ws/relay")}return e.prototype.ngOnInit=function(){var e=this;this.activatedRoute.params.subscribe((function(t){e.deviceId=t.id})),this.logger=new o.ConsoleLogger(1),this.deviceConnection.subscribe((function(t){t?e.init():e.stopKvm()})),this.selectedEncoding.subscribe((function(t){e.selected=t,e.onEncodingChange()}))},e.prototype.ngAfterViewInit=function(){this.init()},e.prototype.instantiate=function(){var e,t,i=this;this.context=null===(e=this.canvas)||void 0===e?void 0:e.nativeElement.getContext("2d"),this.redirector=new o.AMTKvmDataRedirector(this.logger,o.Protocol.KVM,new FileReader,this.deviceId,16994,"","",0,0,JSON.parse(this.token).token,this.server),this.module=new o.AMTDesktop(this.logger,this.context),this.dataProcessor=new o.DataProcessor(this.logger,this.redirector,this.module),this.mouseHelper=new o.MouseHelper(this.module,this.redirector,200),this.keyboardHelper=new o.KeyBoardHelper(this.module,this.redirector),this.redirector.onProcessData=this.module.processData.bind(this.module),this.redirector.onStart=this.module.start.bind(this.module),this.redirector.onNewState=this.module.onStateChange.bind(this.module),this.redirector.onSendKvmData=this.module.onSendKvmData.bind(this.module),this.redirector.onStateChanged=this.onConnectionStateChange.bind(this),this.redirector.onError=this.onRedirectorError.bind(this),this.module.onSend=this.redirector.send.bind(this.redirector),this.module.onProcessData=this.dataProcessor.processData.bind(this.dataProcessor),this.module.bpp=this.selected,this.mouseMove=n.fromEvent(null===(t=this.canvas)||void 0===t?void 0:t.nativeElement,"mousemove"),this.mouseMove.pipe(r.throttleTime(200)).subscribe((function(e){null!=i.mouseHelper&&i.mouseHelper.mousemove(e)}))},e.prototype.onRedirectorError=function(){this.reset()},e.prototype.init=function(){var e=this;this.instantiate(),setTimeout((function(){e.autoConnect()}),4e3)},e.prototype.autoConnect=function(){null!=this.redirector&&(this.redirector.start(WebSocket),this.keyboardHelper.GrabKeyInput())},e.prototype.onEncodingChange=function(){var e=this;this.stopKvm(),n.timer(1e3).subscribe((function(){e.autoConnect()}))},e.prototype.onMouseup=function(e){null!=this.mouseHelper&&this.mouseHelper.mouseup(e)},e.prototype.onMousedown=function(e){null!=this.mouseHelper&&this.mouseHelper.mousedown(e)},e.prototype.onMousemove=function(e){null!=this.mouseHelper&&this.mouseHelper.mousemove(e)},e.prototype.ngOnDestroy=function(){this.stopKvm()},e}();h.ɵfac=function(e){return new(e||h)(t.ɵɵdirectiveInject("userInput"),t.ɵɵdirectiveInject(i.ActivatedRoute))},h.ɵcmp=t.ɵɵdefineComponent({type:h,selectors:[["amt-kvm"]],viewQuery:function(e,o){if(1&e&&(t.ɵɵviewQuery(c,1),t.ɵɵviewQuery(l,1)),2&e){var n=void 0;t.ɵɵqueryRefresh(n=t.ɵɵloadQuery())&&(o.canvas=n.first),t.ɵɵqueryRefresh(n=t.ɵɵloadQuery())&&(o.device=n.first)}},inputs:{width:"width",height:"height",deviceConnection:"deviceConnection",selectedEncoding:"selectedEncoding"},outputs:{deviceStatus:"deviceStatus"},decls:3,vars:2,consts:[["oncontextmenu","return false",1,"canvas",3,"width","height","mouseup","mousedown","mousemove"],["canvas",""]],template:function(e,o){1&e&&(t.ɵɵelementStart(0,"div"),t.ɵɵelementStart(1,"canvas",0,1),t.ɵɵlistener("mouseup",(function(e){return o.onMouseup(e)}))("mousedown",(function(e){return o.onMousedown(e)}))("mousemove",(function(e){return o.onMousemove(e)})),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵproperty("width",o.width)("height",o.height))},styles:[".canvas[_ngcontent-%COMP%]{max-height:80%;max-width:100%}"]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(h,[{type:t.Component,args:[{selector:"amt-kvm",templateUrl:"./kvm.component.html",styleUrls:["./kvm.component.css"]}]}],(function(){return[{type:void 0,decorators:[{type:t.Inject,args:["userInput"]}]},{type:i.ActivatedRoute}]}),{canvas:[{type:t.ViewChild,args:["canvas",{static:!1}]}],device:[{type:t.ViewChild,args:["device",{static:!1}]}],width:[{type:t.Input}],height:[{type:t.Input}],deviceStatus:[{type:t.Output}],deviceConnection:[{type:t.Input}],selectedEncoding:[{type:t.Input}]});var p=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:"userInput",useValue:t}]}},e}();p.ɵfac=function(e){return new(e||p)},p.ɵmod=t.ɵɵdefineNgModule({type:p}),p.ɵinj=t.ɵɵdefineInjector({imports:[[d.HttpClientModule,a.FlexLayoutModule,s.BrowserModule,u.BrowserAnimationsModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(p,{declarations:[h],imports:[d.HttpClientModule,a.FlexLayoutModule,s.BrowserModule,u.BrowserAnimationsModule],exports:[h]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(p,[{type:t.NgModule,args:[{declarations:[h],imports:[d.HttpClientModule,a.FlexLayoutModule,s.BrowserModule,u.BrowserAnimationsModule],exports:[h],schemas:[t.CUSTOM_ELEMENTS_SCHEMA]}]}],null,null),e.KvmComponent=h,e.KvmModule=p,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=kvm.umd.min.js.map