{"version":3,"file":"sol.umd.js","sources":["../../../../src/angular/projects/sol/src/lib/sol.component.ts","../../../../src/angular/projects/sol/src/lib/sol.component.html","../../../../src/angular/projects/sol/src/lib/sol.module.ts","../../../../src/angular/projects/sol/src/public-api.ts","../../../../src/angular/projects/sol/src/sol.ts"],"sourcesContent":["import { Component, EventEmitter, Inject, OnInit, Output, ViewEncapsulation, OnDestroy, Input, AfterViewInit } from '@angular/core'\nimport { Terminal } from 'xterm'\nimport { AmtTerminal, AMTRedirector, TerminalDataProcessor, ConsoleLogger, Protocol, LogLevel } from '@open-amt-cloud-toolkit/ui-toolkit/core'\nimport { ActivatedRoute } from '@angular/router'\nimport { C, V, SPACE } from '@angular/cdk/keycodes'\n\n@Component({\n  selector: 'amt-sol',\n  templateUrl: './sol.component.html',\n  styleUrls: ['./sol.component.css'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class SolComponent implements OnInit, OnDestroy, AfterViewInit {\n  uuid: string = ''\n  terminal: any\n  container!: any\n  term: any\n  redirector: any\n  dataProcessor: any\n  token: any\n  server: string = ''\n  mpsServer: boolean\n  logger: ConsoleLogger = new ConsoleLogger(LogLevel.ERROR)\n  @Output() deviceStatus: EventEmitter<number> = new EventEmitter<number>()\n  @Input() deviceConnection: EventEmitter<boolean> = new EventEmitter<boolean>()\n\n  constructor (@Inject('userInput') public params, private readonly activatedRoute: ActivatedRoute) {\n    this.token = localStorage.getItem('loggedInUser')\n    this.server = `${this.urlConstructor()}/relay`\n    this.mpsServer = this.params.mpsServer.includes('/mps')\n    if (this.mpsServer) {\n      this.server = `${this.urlConstructor()}/ws/relay`\n    }\n  }\n\n  urlConstructor (): string {\n    return this.params.mpsServer.replace('http', 'ws')\n  }\n\n  ngOnInit (): void {\n    this.activatedRoute.params.subscribe(params => {\n      this.uuid = params.id\n    })\n    this.deviceConnection.subscribe((data: boolean) => {\n      if (data) {\n        this.init()\n      } else {\n        this.stopSol()\n      }\n    })\n  }\n\n  ngAfterViewInit (): void {\n    this.init()\n  }\n\n  init (): void {\n    this.instantiate()\n    setTimeout(() => {\n      this.startSol()\n    }, 4000)\n  }\n\n  instantiate (): void {\n    this.terminal = new AmtTerminal()\n    this.dataProcessor = new TerminalDataProcessor(this.terminal)\n    this.redirector = new AMTRedirector(this.logger, Protocol.SOL, new FileReader(), this.uuid, 16994, '', '', 0, 0, JSON.parse(this.token).token, this.server)\n    this.terminal.onSend = this.redirector.send.bind(this.redirector)\n    this.redirector.onNewState = this.terminal.StateChange.bind(this.terminal)\n    this.redirector.onStateChanged = this.onTerminalStateChange.bind(this)\n    this.redirector.onProcessData = this.dataProcessor.processData.bind(this)\n    this.dataProcessor.processDataToXterm = this.handleWriteToXterm.bind(this)\n    this.dataProcessor.clearTerminal = this.handleClearTerminal.bind(this)\n    this.container = document.getElementById('terminal')\n    this.term = new Terminal({\n      rows: 30,\n      cols: 100,\n      cursorStyle: 'block',\n      fontWeight: 'bold'\n    })\n    this.term.open(this.container)\n    this.term.onData((data: any) => {\n      this.handleKeyPress(data)\n    })\n    this.term.attachCustomKeyEventHandler((e: any) => {\n      e.stopPropagation()\n      e.preventDefault()\n      if (e.ctrlKey === true && e.shiftKey === true && e.keyCode === C) {\n        return navigator.clipboard.writeText(this.term.getSelection())\n      } else if (e.ctrlKey === true && e.shiftKey === true && e.keyCode === V) {\n        return navigator.clipboard.readText().then(text => {\n          this.handleKeyPress(text)\n        })\n      } else if (e.code === SPACE) {\n        return this.handleKeyPress(e.key)\n      }\n    })\n  }\n\n  handleKeyPress (domEvent: any): void {\n    this.terminal.TermSendKeys(domEvent)\n  }\n\n  handleClearTerminal (): void {\n    this.term.reset()\n  }\n\n  handleWriteToXterm (str: string): void {\n    this.term.write(str)\n  }\n\n  onTerminalStateChange (redirector: AMTRedirector, state: number): void {\n    this.deviceStatus.emit(state)\n  }\n\n  startSol (): void {\n    if (this.redirector !== null) {\n      this.redirector.start(WebSocket)\n    }\n  }\n\n  stopSol (): void {\n    if (this.redirector !== null) {\n      this.redirector.stop()\n      this.handleClearTerminal()\n      this.term.dispose()\n      this.cleanup()\n    }\n  }\n\n  cleanup (): void {\n    this.terminal = null\n    this.redirector = null\n    this.dataProcessor = null\n    this.term = null\n  }\n\n  ngOnDestroy (): void {\n    this.stopSol()\n  }\n}\n","<div class=\"container\">\r\n    <div id=\"terminal\" class=\"xtermDisplay\" style=\"width: fit-content;\"></div>\r\n</div>","import { CUSTOM_ELEMENTS_SCHEMA, ModuleWithProviders, NgModule } from '@angular/core'\nimport { SolComponent } from './sol.component'\nimport { BrowserModule } from '@angular/platform-browser'\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations'\nimport { FlexLayoutModule } from '@angular/flex-layout'\nimport { HttpClientModule } from '@angular/common/http'\n\n@NgModule({\n  declarations: [\n    SolComponent\n  ],\n  imports: [\n    HttpClientModule,\n    FlexLayoutModule,\n    BrowserModule,\n    BrowserAnimationsModule\n  ],\n  exports: [\n    SolComponent\n  ],\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\n})\nexport class SolModule {\n  public static forRoot (param: any): ModuleWithProviders<SolModule> {\n    return {\n      ngModule: SolModule,\n      providers: [\n        {\n          provide: 'userInput',\n          useValue: param\n        }\n      ]\n    }\n  }\n}\n","/*\r\n * Public API Surface of sol\r\n */\r\n\r\nexport * from './lib/sol.component'\r\nexport * from './lib/sol.module'\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["ConsoleLogger","LogLevel","EventEmitter","AmtTerminal","TerminalDataProcessor","AMTRedirector","Protocol","Terminal","C","V","SPACE","i0.ɵɵelementStart","i0.ɵɵelement","i0.ɵɵelementEnd","Component","ViewEncapsulation","Inject","Output","Input","HttpClientModule","FlexLayoutModule","BrowserModule","BrowserAnimationsModule","NgModule","CUSTOM_ELEMENTS_SCHEMA"],"mappings":"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"}