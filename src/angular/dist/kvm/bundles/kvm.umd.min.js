!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@open-amt-cloud-toolkit/ui-toolkit/core"),require("rxjs"),require("rxjs/operators"),require("@angular/platform-browser"),require("@angular/platform-browser/animations"),require("@angular/flex-layout"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("kvm",["exports","@angular/core","@open-amt-cloud-toolkit/ui-toolkit/core","rxjs","rxjs/operators","@angular/platform-browser","@angular/platform-browser/animations","@angular/flex-layout","@angular/common/http"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).kvm={},e.ng.core,e["@open-amt-cloud-toolkit"]["ui-toolkit"].core,e.rxjs,e.rxjs.operators,e.ng.platformBrowser,e.ng.platformBrowser.animations,e.ng.flexLayout,e.ng.common.http)}(this,(function(e,t,o,n,i,r,s,u,a){"use strict";var d=["canvas"],c=function(){function e(e){var o=this;this.params=e,this.width=400,this.height=400,this.deviceState=0,this.deviceStatus=new t.EventEmitter,this.deviceConnection=new t.EventEmitter,this.selectedEncoding=new t.EventEmitter,this.powerState=0,this.deviceId="",this.selected=1,this.server="",this.mouseMove=null,this.encodings=[{value:1,viewValue:"RLE 8"},{value:2,viewValue:"RLE 16"}],this.urlConstructor=function(){return o.params.server.replace("http","ws")},this.onConnectionStateChange=function(e,t){o.deviceState=t,o.deviceStatus.emit(t)},this.reset=function(){o.redirector=null,o.module=null,o.dataProcessor=null,o.height=400,o.width=400,o.instantiate()},this.stopKvm=function(){o.redirector.stop(),o.keyboardHelper.UnGrabKeyInput(),o.reset()},this.deviceId=this.params.deviceId,this.server=this.urlConstructor()+"/relay",this.mpsServer=this.params.server.includes("/mps"),this.mpsServer&&(this.server=this.urlConstructor()+"/ws/relay")}return e.prototype.ngOnInit=function(){var e=this;this.logger=new o.ConsoleLogger(1),this.deviceConnection.subscribe((function(t){t?e.init():e.stopKvm()})),this.selectedEncoding.subscribe((function(t){e.selected=t,e.onEncodingChange()}))},e.prototype.ngAfterViewInit=function(){this.init()},e.prototype.instantiate=function(){var e,t,r=this;this.context=null===(e=this.canvas)||void 0===e?void 0:e.nativeElement.getContext("2d"),this.redirector=new o.AMTKvmDataRedirector(this.logger,o.Protocol.KVM,new FileReader,this.deviceId,16994,"","",0,0,this.params.authToken,this.server),this.module=new o.AMTDesktop(this.logger,this.context),this.dataProcessor=new o.DataProcessor(this.logger,this.redirector,this.module),this.mouseHelper=new o.MouseHelper(this.module,this.redirector,200),this.keyboardHelper=new o.KeyBoardHelper(this.module,this.redirector),this.redirector.onProcessData=this.module.processData.bind(this.module),this.redirector.onStart=this.module.start.bind(this.module),this.redirector.onNewState=this.module.onStateChange.bind(this.module),this.redirector.onSendKvmData=this.module.onSendKvmData.bind(this.module),this.redirector.onStateChanged=this.onConnectionStateChange.bind(this),this.redirector.onError=this.onRedirectorError.bind(this),this.module.onSend=this.redirector.send.bind(this.redirector),this.module.onProcessData=this.dataProcessor.processData.bind(this.dataProcessor),this.module.bpp=this.selected,this.mouseMove=n.fromEvent(null===(t=this.canvas)||void 0===t?void 0:t.nativeElement,"mousemove"),this.mouseMove.pipe(i.throttleTime(200)).subscribe((function(e){null!=r.mouseHelper&&r.mouseHelper.mousemove(e)}))},e.prototype.onRedirectorError=function(){this.reset()},e.prototype.init=function(){var e=this;this.instantiate(),setTimeout((function(){e.autoConnect()}),4e3)},e.prototype.autoConnect=function(){null!=this.redirector&&(this.redirector.start(WebSocket),this.keyboardHelper.GrabKeyInput())},e.prototype.onEncodingChange=function(){var e=this;this.stopKvm(),n.timer(1e3).subscribe((function(){e.autoConnect()}))},e.prototype.checkPowerStatus=function(){return 2===this.powerState.powerstate},e.prototype.onMouseup=function(e){null!=this.mouseHelper&&this.mouseHelper.mouseup(e)},e.prototype.onMousedown=function(e){null!=this.mouseHelper&&this.mouseHelper.mousedown(e)},e.prototype.onMousemove=function(e){null!=this.mouseHelper&&this.mouseHelper.mousemove(e)},e.prototype.ngOnDestroy=function(){this.stopKvm()},e}();c.ɵfac=function(e){return new(e||c)(t.ɵɵdirectiveInject("userInput"))},c.ɵcmp=t.ɵɵdefineComponent({type:c,selectors:[["amt-kvm"]],viewQuery:function(e,o){if(1&e&&t.ɵɵviewQuery(d,1),2&e){var n;t.ɵɵqueryRefresh(n=t.ɵɵloadQuery())&&(o.canvas=n.first)}},inputs:{width:"width",height:"height",deviceConnection:"deviceConnection",selectedEncoding:"selectedEncoding"},outputs:{deviceState:"deviceState",deviceStatus:"deviceStatus"},decls:3,vars:2,consts:[["oncontextmenu","return false",1,"canvas",3,"width","height","mouseup","mousedown","mousemove"],["canvas",""]],template:function(e,o){1&e&&(t.ɵɵelementStart(0,"div"),t.ɵɵelementStart(1,"canvas",0,1),t.ɵɵlistener("mouseup",(function(e){return o.onMouseup(e)}))("mousedown",(function(e){return o.onMousedown(e)}))("mousemove",(function(e){return o.onMousemove(e)})),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵproperty("width",o.width)("height",o.height))},styles:[".canvas[_ngcontent-%COMP%]{max-height:80%;max-width:100%}"]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(c,[{type:t.Component,args:[{selector:"amt-kvm",templateUrl:"./kvm.component.html",styleUrls:["./kvm.component.css"]}]}],(function(){return[{type:void 0,decorators:[{type:t.Inject,args:["userInput"]}]}]}),{canvas:[{type:t.ViewChild,args:["canvas",{static:!1}]}],width:[{type:t.Input}],height:[{type:t.Input}],deviceState:[{type:t.Output}],deviceStatus:[{type:t.Output}],deviceConnection:[{type:t.Input}],selectedEncoding:[{type:t.Input}]});var l=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:"userInput",useValue:t}]}},e}();l.ɵfac=function(e){return new(e||l)},l.ɵmod=t.ɵɵdefineNgModule({type:l}),l.ɵinj=t.ɵɵdefineInjector({imports:[[a.HttpClientModule,u.FlexLayoutModule,r.BrowserModule,s.BrowserAnimationsModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(l,{declarations:[c],imports:[a.HttpClientModule,u.FlexLayoutModule,r.BrowserModule,s.BrowserAnimationsModule],exports:[c]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(l,[{type:t.NgModule,args:[{declarations:[c],imports:[a.HttpClientModule,u.FlexLayoutModule,r.BrowserModule,s.BrowserAnimationsModule],exports:[c],schemas:[t.CUSTOM_ELEMENTS_SCHEMA]}]}],null,null),e.KvmComponent=c,e.KvmModule=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=kvm.umd.min.js.map